# Linux について

## ディストリビューション

Linux カーネルの他にシェルやライブラリ等を梱包したもの

### 代表的なディストリビューション

#### Debian(Debian 系)

- 安定性と信頼性が高い
- 利用可能なパッケージが多い

#### Ubuntu(Debian 系)

- 使いやすい
- デスクトップ、サーバー環境で使用される
- こだわりがなければこれを選んでおけばいい

#### CentOS(RedHat 系)

- 長期サポート
- 商用利用、企業向け

## カーネル・システムコール・シェルの仕組み

### カーネル

OS の核となる部分
ハードウェア等の制御を行う

### システムコール

カーネルを操作する API

### シェル

システムコールを呼び出す

- bash
- zsh 等

## よく使うショートカット

### 行の先頭に移動

```
ctrl + a
```

### 行の末尾に移動

```
ctrl + e
```

### 行末まで削除

```
ctrl + k
```

### 行頭まで削除

```
ctrl + u
```

###

## よく使うコマンド

### 現在のディレクトリを表示

```bash
pwd
```

### ディレクトリの移動

```bash
cd <移動先ディレクトリ>
```

### ディレクトリの一覧を表示

```bash
ls
```

#### オプション

- -a 隠しファイル・隠しディレクトリを表示
- -l 詳細情報を表示
- -h 容量を単位で表示
- -t ファイルの最終更新日時でソートして表示

### ファイルの更新日時を更新

ファイルがない場合はファイルを作成

```bash
touch <ファイル名>
```

#### オプション

- -t <yyyyMMddHHmmss> 指定の日時でファイル更新日時を更新

### ファイルをコピーする

```bash
cp <コピー元ファイル> <コピー先ファイル>
```

#### オプション

- -i コピー前に確認を表示
- -r ディレクトリをコピー
- -u コピー元の更新日時がコピー先より新しい場合のみコピー
- -v コピーした内容を表示

### ファイルを移動する

```bash
mv <移動元ファイル> <移動先ファイル>
```

#### オプション

- -i 移動先に同名のファイルが存在する場合、確認を表示
- -n 移動先に同名のファイルが存在する場合、移動しない

### ファイルを削除する

```bash
rm <ファイル名>
```

#### オプション

- -i 削除前に確認を表示
- -r ディレクトリを削除

### ディレクトリを作成する

```bash
mkdir <ディレクトリ名>
```

#### オプション

- -p 階層構造のディレクトリを作成

###ファイルの中身を表示

```bash
cat <ファイル名>
```

#### オプション

- -n 行番号を表示

### ファイルから検索ワードを検索する

```bash
grep <検索ワード> <ファイル名>
```

#### オプション

- -i 検索ワードの大文字・小文字を区別しない
- -n 行番号を表示
- -r ディレクトリ配下を全て検索

### 文字の出力

```bash
echo <文字列>
```

#### オプション

- -e 改行(¥n)を表示

## 便利なコマンド

### ファイル・ディレクトリの検索

```bash
find <検索対象ディレクトリ> <条件>

// 指定したファイル名を検索(ワイルドカードOK)
find <検索対象ディレクトリ> -name <ファイル名>

// ファイルサイズで検索(例は1Mb以上)
find <検索対象ディレクトリ> -size +1M

// 更新日時で検索(例は過去7日間以内)
find <検索対象ディレクトリ> -mtime -7
```

### テキストファイルの内容を編集・置換

```bash
// input.txtの中身を置換してoutput.txtに出力
// ※「/g」は全てを置換
sed 's/<置換前文字列>/<置換後文字列>/g' input.txt > output.txt
```

### 圧縮・解凍

```bash
// 圧縮(元ファイルを上書き)
gzip <ファイル名>
　
// 圧縮(元ファイルを残す)
gzip -c <ファイル名> > <圧縮後ファイル名.gz>

// 解凍
gunzip <gzファイル>
gzip -d <gzファイル>
```

### アーカイブ

```bash
// 指定のファイル名でファイルを圧縮してアーカイブする
tar -czvf <アーカイブ名.tar.gz> <アーカイブするファイル1> <アーカイブするファイル2> ・・・

// 指定のアーカイブされたファイルを展開・解凍
tar -xzvf <アーカイブ名.tar.gz>

```

## エイリアス

オプションを含めたコマンドのショートカットを作成できる

### 設定の仕方

```bash
alias lsa='ls -a'
```

## 環境変数

システム全体やアプリケーションの設定を保持する変数

### 確認方法

```bash
printenv PATH
echo $PATH
```

### 設定方法

```bash
export 変数名=値

```

### 削除方法

```bash
unset 変数名
```

## エイリアス・環境変数の永続化

※シェルによって異なる

bash の場合

ルートディレクトリ内の隠しファイル「.bashrc」にコマンドと同じ内容を追記する

## PATH

シェルのコマンドを探すディレクトリのリストを保持する環境変数

### コマンドの場所を確認

```bash
which <コマンド>
```

### PATH に追加する方法

```bash
export PATH=$PATH:<追加するディレクトリ>
```

## リダイレクト

コマンドの出力をファイルや画面出力に転送する

grep で検索した結果を別ファイルに出力したりする時に使う

### 標準出力をリダイレクト

```bash
echo "hello world" > helloworld.txt

// 追記する場合は「>>」
echo "hello world2" >> helloworld.txt
```

### 標準入力をリダイレクト

```bash
echo cat < helloworld.txt
```

### 標準エラー出力をリダイレクト

```bash
cat xxxx 2> error.log

// 追記する場合は「>>」
cat yyyy 2>> helloworld.txt
```

### 標準出力と標準エラー出力をリダイレクト

```bash
cat helloworld.txt &> output.log

// 追記する場合は「&>>」
cat hogehoge.txt &>> output.log
```

## パイプ

コマンドを別のコマンドに転送する

```bash
// リスト出力したもので「hello」が含まれる行を出力
ls -l  | grep "hello"
```

## vi

コマンドラインで完結するテキストエディタ

### 使い方

#### 起動

```bash
// 新規
vi

// 既存のファイルを開く
vi <ファイル名>

```

#### モード

モードは４種類

- ノーマル(esc)・・・テキストの移動、削除、コピー、ペーストなど
- インサート(i)・・・テキストの入力
- コマンドライン(:)・・・ファイルの保存、編集の終了
- ビジュアル(v)・・・矩形入力など

#### ノーマルモード

- j ・・・カーソルを下に移動
- k ・・・カーソルを上に移動
- h ・・・カーソルを左に移動
- l ・・・カーソルを右に移動
- w ・・・単語単位でカーソルを後ろに移動
- b ・・・単語単位でカーソルを前に移動
- 0 ・・・行頭に移動
- $ ・・・行末に移動
- x ・・・文字を削除
- dd ・・・現在の行を削除
- yy ・・・現在の行をコピー
- p ・・・次の行にペースト
- P ・・・前の行にペースト
- u ・・・undo
- /<検索ワード> ・・・ファイル内検索

### コマンドラインモード

- :q ・・・閉じる
- :w ・・・保存
- :wq ・・・保存して閉じる
- :q! ・・・保存せず閉じる

## ディレクトリ構造

基本的なディレクトリの構造と内容

| ディレクトリ | 内容                                                   |
| ------------ | ------------------------------------------------------ |
| /bin         | 基本的なシステムコマンドが格納                         |
| /sbin        | システム管理者用のコマンドが格納                       |
| /usr         | ユーザーが共有するデータが格納                         |
| /etc         | システム設定ファイルや各種ソフトのの設定ファイルが格納 |
| /var         | 変更され得るデータが格納(ログ等)                       |
| /tmp         | 一時ファイルが格納                                     |
| /home        | ユーザーのホームディレクトリが格納                     |

## ユーザーとグループ

### 自分の所属しているグループを表示

```bash
groups

// or

id
```

## パーミッション

### 読み方

### <span style="font-size: 40px;color: red;">-</span><span style="font-size: 40px;color: blue;">rw-</span><span style="font-size: 40px;color: green;">r--</span><span style="font-size: 40px;color: yellow;">r--</span>

- <span style="color: red;">ファイルの種類</span>

- <span style="color: blue;">ファイルの所有ユーザーの権限</span>

- <span style="color: green;">所有グループの権限</span>

- <span style="color: yellow;">その他ユーザーの権限</span>

### 種類

| 表記 | 種類                         |
| ---- | ---------------------------- |
| -    | 通常のファイル               |
| d    | ディレクトリ                 |
| l    | シンボリックリンク           |
| b    | ブロックデバイスファイル     |
| c    | キャラクターデバイスファイル |

### 権限

| 表記 | 内容         |
| ---- | ------------ |
| r    | 読み取り権限 |
| w    | 書き込み権限 |
| x    | 実行権限     |

### 変更方法

以下のコマンドを実行する

```bash
chmod <変更後パーミッション> <ファイル名>
```

変更後のパーミッションは以下の内容を組み合わせる

| 対象               | 操作           | 対象権限     |
| ------------------ | -------------- | ------------ |
| u : 所有者         | + : 権限追加   | r : 読み取り |
| g : 所有グループ   | - : 権限削除   | w : 書き込み |
| o : その他ユーザー | = : 権限上書き | x : 実行     |
| a : 全てのユーザー |                |              |

## プロセス

### 確認方法

```bash
// 定期的に画面を更新
top

// よく使う方法 さらにgrepで絞り込んだりする
ps aux
```

### 停止方法

```bash
kill <プロセスID>
```
